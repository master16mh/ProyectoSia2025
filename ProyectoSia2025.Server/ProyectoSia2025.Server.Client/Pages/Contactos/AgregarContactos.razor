@using ProyectoSia2025.Shared.DTOS
@inject IHttpService http

@if (visible)
{
    <div class="modal-backdrop fade show"></div>
}

<div class="modal fade @(visible ? "show d-block" : "")" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Agregar Contacto</h5>
            </div>

            <EditForm Model="@modelo" OnValidSubmit="Guardar">
                <DataAnnotationsValidator />
                <div class="modal-body">
                    <div class="form-group">
                        <label>Nombre</label>
                        <InputText class="form-control" @bind-Value="modelo.Nombre" />
                        <ValidationMessage For="@(() => modelo.Nombre)" />
                    </div>

                    <div class="form-group">
                        <label>Apellido</label>
                        <InputText class="form-control" @bind-Value="modelo.Apellido" />
                        <ValidationMessage For="@(() => modelo.Apellido)" />
                    </div>

                    <div class="form-group">
                        <label>DNI</label>
                        <InputText class="form-control" @bind-Value="modelo.DNI" />
                        <ValidationMessage For="@(() => modelo.DNI)" />
                    </div>

                    <div class="form-group">
                        <label>Email</label>
                        <InputText class="form-control" @bind-Value="modelo.Email" />
                        <ValidationMessage For="@(() => modelo.Email)" />
                    </div>

                    <div class="form-group">
                        <label>Teléfono</label>
                        <InputText class="form-control" @bind-Value="modelo.Telefono" />
                        <ValidationMessage For="@(() => modelo.Telefono)" />
                    </div>

                    <div class="form-group">
                        <label>Cargo</label>
                        <InputSelect class="form-control" @bind-Value="modelo.Cargo">
                            <option value="">-- Seleccione un cargo --</option>
                            <option value="Inspector">Inspector</option>
                            <option value="Supervisor">Supervisor</option>
                            <option value="Diseñador">Diseñador</option>
                            <option value="Asistente">Asistente</option>
                        </InputSelect>
                        <ValidationMessage For="@(() => modelo.Cargo)" />
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="Cerrar">Cancelar</button>
                    <button type="submit" class="btn btn-success">Guardar</button>
                </div>
            </EditForm>
        </div>
    </div>
</div>

@code {
    [Parameter] public int EmpresaId { get; set; }
    [Parameter] public EventCallback OnContactoAgregado { get; set; }

    ContactoDTO modelo = new();
    EditContext? editContext;
    bool visible = false;

    public void Mostrar()
    {
        modelo = new();
        modelo.EmpresaId = EmpresaId;
        visible = true;
    }

    void Cerrar() => visible = false;

    async Task Guardar()
    {
        var response = await http.Post<ContactoDTO, ContactoDTO>("api/ContactoEmpresa", modelo);
        if (!response.Error)
        {
            await OnContactoAgregado.InvokeAsync();
            Cerrar();
        }
    }
}
